<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>汇报搜索优化历程 -</title><meta name=keywords content="zyg,独立,博客,程序员,个人,思考,读书,笔记,技术,分享,java"><meta property="og:title" content="汇报搜索优化历程"><meta property="og:site_name" content><meta property="og:image" content="/img/author.jpg"><meta name=title content="汇报搜索优化历程 -"><meta name=description content="Article description."><link rel="shortcut icon" href=https://1162492411.github.io/docs/img/favicon.ico><link rel=apple-touch-icon href=https://1162492411.github.io/docs/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=https://1162492411.github.io/docs/img/apple-touch-icon.png><link href="https://1162492411.github.io/docs/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel=stylesheet type=text/css><link href="https://1162492411.github.io/docs/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel=stylesheet type=text/css><link href=https://1162492411.github.io/docs/css/main.css rel=stylesheet type=text/css><link href=https://1162492411.github.io/docs/css/syntax.css rel=stylesheet type=text/css><script type=text/javascript id=hexo.configuration>var NexT=window.NexT||{};var CONFIG={scheme:'Pisces',sidebar:{"position":"left","display":"post"},fancybox:true,motion:true};</script></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class="site-meta custom-logo"><div class=custom-logo-site-title><a href=https://1162492411.github.io/docs/ class=brand rel=start><span class=logo-line-before><i></i></span><span class=site-title></span><span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>人生天地间，忽如远行客</p></div><div class=site-nav-toggle><button>
<span class=btn-bar></span><span class=btn-bar></span><span class=btn-bar></span></button></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=https://1162492411.github.io/docs/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class=menu-item><a href=https://1162492411.github.io/docs/categories/%E6%8A%80%E6%9C%AF/ rel=section><i class="menu-item-icon fa fa-fw fa-code"></i><br>技术</a></li><li class=menu-item><a href=https://1162492411.github.io/docs/categories/%E5%AE%9E%E6%88%98/ rel=section><i class="menu-item-icon fa fa-fw fa-code"></i><br>实战</a></li><li class=menu-item><a href=https://1162492411.github.io/docs/categories/%E7%AC%94%E8%AE%B0/ rel=section><i class="menu-item-icon fa fa-fw fa-book"></i><br>笔记</a></li><li class=menu-item><a href=https://1162492411.github.io/docs/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/ rel=section><i class="menu-item-icon fa fa-fw fa-leaf"></i><br>面试题</a></li><li class=menu-item><a href=https://1162492411.github.io/docs/post/ rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class=menu-item><a href=https://1162492411.github.io/docs/about/ rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br></a></li></ul><div class=site-search><div class=popup><span class="search-icon fa fa-search"></span><input type=text id=local-search-input><div id=local-search-result></div><span class=popup-btn-close>close</span></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://1162492411.github.io/docs/post/%E6%B1%87%E6%8A%A5%E6%90%9C%E7%B4%A2%E4%BC%98%E5%8C%96%E5%8E%86%E7%A8%8B/ itemprop=url>汇报搜索优化历程</a></h1><div class=post-meta><span class=post-time><span class=post-meta-item-icon><i class="fa fa-calendar-o"></i></span><span class=post-meta-item-text></span><time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2020-11-24">2020-11-24</time></span>
<span class=post-category>&nbsp; | &nbsp;
<span class=post-meta-item-icon><i class="fa fa-folder-o"></i></span><span class=post-meta-item-text></span><span itemprop=about itemscope itemtype=https://schema.org/Thing><a href=https://1162492411.github.io/docs/categories/%E5%AE%9E%E6%88%98 itemprop=url rel=index><span itemprop=name>实战</span></a>
&nbsp;</span></span>
<span>&nbsp; | &nbsp;
<span class=post-meta-item-icon><i class="fa fa-eye"></i></span><span class=post-meta-item-text></span><span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><h2 id=1背景介绍>1.背景介绍</h2><p>OA中存在工作汇报与汇报审批两个应用，前者用于员工填写汇报，如日报、周报、月报、会议纪要等，后者用于领导查阅员工填写的汇报，在查阅汇报时提供搜索功能，可根据关键字对汇报内容进行搜索。</p><h2 id=11-表关系>1.1 表关系</h2><p>搜索汇报相关的数据表表结构如下</p><table><thead><tr><th>t_report(汇报主表,存储员工填写的汇报记录,与t_report_value为一对多关系)</th><th></th><th></th></tr></thead><tbody><tr><td>字段名</td><td>字段类型</td><td>字段说明</td></tr><tr><td>n_id</td><td>bigint(20)</td><td>主键</td></tr><tr><td>n_account_id</td><td>bigint(20)</td><td>人员id</td></tr><tr><td>n_modify_time</td><td>bigint(20)</td><td>修改时间</td></tr><tr><td>n_report_date</td><td>bigint(20)</td><td>汇报日期</td></tr><tr><td>n_status</td><td>bigint(20)</td><td>数据状态,0正常,1已删除</td></tr><tr><td>其他字段….</td><td></td><td></td></tr><tr><td>t_report_value(汇报子表,存储员工填写的汇报记录详情)</td><td></td><td></td></tr><tr><td>字段名</td><td>字段类型</td><td>字段说明</td></tr><tr><td>n_id</td><td>bigint(20)</td><td>主键</td></tr><tr><td>n_report_id</td><td>bigint(20)</td><td>汇报id，等同t_report的n_id</td></tr><tr><td>n_moudle_id</td><td>bigint(20)</td><td>模板id</td></tr><tr><td>n_moudle_widget_id</td><td>bigint(20)</td><td>模板的控件id</td></tr><tr><td>c_widget_value</td><td>varchar(12380)</td><td>汇报的内容</td></tr><tr><td>其他字段….</td><td></td><td></td></tr><tr><td>t_report_moudle(汇报模板表,存储汇报使用的模板,与t_report_widget为一对多关系)</td><td></td><td></td></tr><tr><td>n_id</td><td>bigint(20)</td><td>主键</td></tr><tr><td>c_name</td><td>varchar(255)</td><td>模板名称</td></tr><tr><td>其他字段…</td><td></td><td></td></tr><tr><td>t_report_widget(汇报控件表,存储汇报使用的模板中的控件)</td><td></td><td></td></tr><tr><td>n_id</td><td>bigint(20)</td><td>主键</td></tr><tr><td>n_moudle_id</td><td>bigint(20)</td><td>模板id,等同t_report_moudle的n_id</td></tr><tr><td>c_title</td><td>varchar(20)</td><td>控件名,如标题、内容、本周总结、本月计划</td></tr><tr><td>n_value_limt</td><td>int(8)</td><td>控件值长度限制,如标题最大长度、内容最大长度</td></tr><tr><td>其他字段….</td><td></td><td></td></tr></tbody></table><h2 id=12-数据增长速度>1.2 数据增长速度</h2><p>模板表与模板控件表的数量增长较慢，数据增长主要为汇报主表与汇报子表，每天两表的数据增长速度大致如下</p><p>t_report：1 * 员工数</p><p>t_report_value : 1 * 员工数 * 模板数 * 控件数</p><h2 id=13-搜索流程>1.3 搜索流程</h2><p>搜索功能流程如下：</p><p>A接收请求</p><p>B查询当前人管辖的人员列表</p><p>C查询当前人能够查看的模板id列表</p><p>D将前两步的结果、关键词、分页参数等一起作为条件，搜索符合条件的汇报</p><p>E包装汇报的其他数据(如汇报的浏览数量、汇报的附件数量)</p><p>F返回数据</p><h1 id=2阶段a--mysql-like查询>2.阶段A – MySQL like查询</h1><p>在应用运行初期，由于汇报数据少，数据增长速度慢，且对搜索接口未提出其他方面的要求，因此采用like模糊查询符合条件的汇报数据，核心SQL如下</p><p>SELECT</p><p>DISTINCT t1.n_id AS id,</p><p>t1.n_create_time AS createTime,</p><p>t1.n_modify_time AS modifyTime,</p><p>t1.n_account_id AS accountId,</p><p>t1.c_coordinate AS coordinate,</p><p>t1.c_at_ids AS atIds,</p><p>t1.n_report_date AS reportDate</p><p>FROM</p><p>t_report t1</p><p>LEFT JOIN t_report_value brmwv ON t1.n_id = brmwv.n_report_id</p><p>WHERE</p><p>brmwv.c_widget_value like &lsquo;%:1%&rsquo;</p><p>AND brmwv.n_employee_id IN(:2)</p><p>AND brmwv.n_moudle_id IN(:3)</p><p>AND t1.n_delete_flag = 0</p><p>AND t1.n_modify_time &lt; :4</p><p>ORDER BY</p><p>t1.n_report_date DESC,</p><p>t1.n_modify_time DESC LIMIT 0, :5</p><p>##:1为关键词,:2为人员列表,:3为模块列表,:4为分页参数,:5为分页条数</p><p>方案优点：无需额外改动</p><p>方案缺点：数据量多时效率低</p><h2 id=3阶段b---mysql-全文索引>3.阶段B - MySQL <strong>全文索引</strong></h2><p>以公司环境为例，应用运行一年后，汇报主表的数据量大约为33w条(330天* 1000员工),汇报子表的数据量为33w条(330天 * 1000 员工 * 1个模板 * 1个控件),这时候搜索接口的查询汇报SQL平均速度为10S+，like搜索方案的主要瓶颈在于like搜索进行全表扫描，于是考虑在c_widget_value字段中建立索引来提高搜索速度，由于c_widget_value大部分为中文字符,因此需要在该字段建立全文索引并支持对中文的搜索。</p><p>经查阅资料，MySQL中的全文索引自v5.6.24开始支持InnoDB引擎，自v5.7开始增加ngram分词器以支持中日韩文，全文索引支持的数据库字段类型为char、varchar、text，于是此方案在MySQL中执行以下语句即可:</p><p>create fulltext index vfin on t_ report _value (c_widget_value) with parser ngram;</p><p>建立全文索引后SQL需要进行相应的改写，使用match against ，改写后的SQL如下</p><p>SELECT</p><p>DISTINCT t1.n_id AS id,</p><p>t1.n_create_time AS createTime,</p><p>t1.n_modify_time AS modifyTime,</p><p>t1.n_account_id AS accountId,</p><p>t1.c_coordinate AS coordinate,</p><p>t1.c_at_ids AS atIds,</p><p>t1.n_report_date AS reportDate</p><p>FROM</p><p>t _report t1</p><p>LEFT JOIN t_ report_ value brmwv ON t1.n_id = brmwv.n_report_id</p><p>WHERE</p><p>match(c_widget_value) against (':1&rsquo;)</p><p>AND brmwv.n_employee_id IN(:2)</p><p>AND brmwv.n_moudle_id IN(:3)</p><p>AND t1.n_delete_flag = 0</p><p>AND t1.n_modify_time &lt; :4</p><p>ORDER BY</p><p>t1.n_report_date DESC,</p><p>t1.n_modify_time DESC LIMIT 0, :5</p><p>##:1为关键词,:2为人员列表,:3为模块列表,:4为分页参数,:5为分页条数</p><p>在使用该方案时发现接口整体速度确实有了提升，但是当输入的关键词为单个字符或两个字符时无法查询到数据，于是继续查阅相关资料，得到以下信息：MySQL中的innodb_ft_min_token_size配置项表示全文索引最小分词长度,该值默认为3。于是将该配置项的值修改为1，重建了全文索引并重启MySQL，再次搜索时输入任意个字符均可搜索到相关数据。</p><p>方案时间：SQL平均时间2s，整体接口平均时间8s</p><p>方案优点：SQL查询效率提高</p><p>方案缺点：建立了索引额外占据了空间、对该表的CRUD都将降低响应速度、ngram分词粒度越细那么占据空间越大、修改MySQL的全文索引配置项后需要重建全文索引并重启MySQL才能生效、输入的关键词长度增加时SQL响应速度呈指数级增长。</p><h2 id=4阶段c---elasticsearch--mysql>4.阶段C - ElasticSearch + MySQL</h2><p>全文索引方案与like方案相比，的确提升了SQL的响应速度，但是SQL响应速度受关键词影响极大，若输入的关键词长度过长，或输入的关键词几乎匹配了数据库中绝大部分数据，那么该接口的整体响应速度仍然堪忧；建立全文索引后，对t_ report_ value进行操作时响应速度将会有所降低；数据进一步增长时SQL速度将进一步变慢，在百万级以上时表现不佳；ngram分词器的分词规则不够灵活，导致分词后的索引占据空间很大。</p><p>一想到大数据量秒级响应，那么ElasticSearch会作为首选项。加上搜索接口对数据实时性要求不高，因此可以将汇报主表与汇报子表的数据存储在ElasticSearch中，对c_widget_value使用ik_smart进行分词存储，并定时更新ES数据，查询时从ES查询数据，然后再进行接口内其他业务操作。</p><p>由于ES并不擅长关联操作，于是该方案设计为OA后台执行定时任务，将汇报主表与汇报子表的数据增量整合为一张表t_report_sync_data,再通过LogStash将MySQL中表t_report_sync_data的数据增量同步到ES中。</p><p>记表t_ report为表A(汇报主表), t_report_value为表B(汇报子表), t _report_moudle(汇报模板表)为 C，以下是t_report_sync_data中各字段与这些表的对应关系</p><table><thead><tr><th>字段名</th><th>原始表</th><th>原始字段</th><th>说明</th></tr></thead><tbody><tr><td>reportId</td><td>report</td><td>n_id</td><td>汇报id</td></tr><tr><td>createTime</td><td>report</td><td>n_create_time</td><td>汇报创建时间</td></tr><tr><td>modifyTime</td><td>report</td><td>n_modify_time</td><td>汇报修改时间</td></tr><tr><td>accountId</td><td>report</td><td>n_account_id</td><td>人员id</td></tr><tr><td>coordinate</td><td>report</td><td>c_coordinate</td><td>坐标</td></tr><tr><td>atds</td><td>report</td><td>c_at_ids</td><td>艾特的人员id集合</td></tr><tr><td>deleteFlag</td><td>report</td><td>n_delete_flag</td><td>删除标识</td></tr><tr><td>companyId</td><td>report</td><td>n_company_id</td><td>企业id</td></tr><tr><td>reportDate</td><td>report</td><td>n_report_date</td><td>汇报日期</td></tr><tr><td>moduleId</td><td>reportValue</td><td>n_module_widget_id</td><td>模块id</td></tr><tr><td>widgetValue</td><td>reportValue</td><td>c_widget_value</td><td>控件值</td></tr></tbody></table><p>那么查询时的SQL就改变为了ES的查询语句，Java代码如下</p><p>// 条件构建</p><p>BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</p><p>//widgetValue,模糊查询</p><p>BoolQueryBuilder builder = QueryBuilders.boolQuery();</p><p>builder.should(QueryBuilders.matchPhraseQuery(&ldquo;widgetValue&rdquo;, queryBean.getWidgetValue()));</p><p>boolQueryBuilder.must(builder);</p><p>//accountId,in</p><p>boolQueryBuilder.filter(inParamBuilder(queryBean.getAccountIds(), &ldquo;accountId&rdquo;));</p><p>//moudleId, in</p><p>boolQueryBuilder.filter(inParamBuilder(queryBean.getMoudleIds(), &ldquo;moudleId&rdquo;));</p><p>//deleteFlag,0</p><p>boolQueryBuilder.filter(QueryBuilders.termQuery(&ldquo;deleteFlag&rdquo;, 0));</p><p>//modifyTime,&lt;</p><p>RangeQueryBuilder rangeQuery = QueryBuilders.rangeQuery(&ldquo;modifyTime&rdquo;);</p><p><a href=http://rangequery.lt/>rangeQuery.lt</a>(queryBean.getModifyTime());</p><p>boolQueryBuilder.filter(rangeQuery);</p><p>//聚合请求构建</p><p>//按reportId分桶,按reportDate降序,按modifyTime降序,取前n桶
TermsBuilder termsBuilder = AggregationBuilders
.terms(&ldquo;group_by_reportId&rdquo;)
.field(&ldquo;reportId&rdquo;)
.subAggregation(AggregationBuilders.max(&ldquo;sortA&rdquo;).field(&ldquo;reportDate&rdquo;))
.subAggregation(AggregationBuilders.max(&ldquo;sortB&rdquo;).field(&ldquo;modifyTime&rdquo;))
. order(Terms.Order.compound(Terms.Order.aggregation(&ldquo;sortA&rdquo;,false),Terms.Order.aggregation(&ldquo;sortB&rdquo;,false)))
.size(queryBean.getPageSize());</p><p>//设置每组内取一条数据</p><p>TopHitsBuilder hitsBuilder = AggregationBuilders.topHits(&ldquo;groupDataDetail&rdquo;).setSize(1);</p><p>//每组内, 设置查询的字段</p><p>hitsBuilder.setFetchSource(WORK_REPORT_FIELDS, null);</p><p>termsBuilder.subAggregation(hitsBuilder);</p><p>//将分组挂靠在查询请求内,size设置es hit的原始数据,由于业务系统一般不需要,故设置不返回此项</p><p>requestBuilder.addAggregation(termsBuilder).setSize(0);</p><p>//设置Query并获取响应</p><p>SearchResponse searchResponse = requestBuilder.setQuery(boolQueryBuilder).execute().actionGet();</p><p>//处理响应,略</p><p>//inParamBuilder方法如下，用于解决同一个字段的terms的参数过多问题</p><p>private QueryBuilder inParamBuilder(List list, String field) {
int count = 800;
int len = list.size();
int size = len % count == 0 ? len / count : (len / count) + 1;
BoolQueryBuilder shouldQuery = QueryBuilders.boolQuery();
for (int i = 0; i &lt; size; i++) {
int fromIndex = i * count;
int toIndex = Math.min(fromIndex + count, len);
List subList = list.subList(fromIndex, toIndex);
TermsQueryBuilder termsQueryBuilder = QueryBuilders.termsQuery(field, subList);
shouldQuery.should(termsQueryBuilder);
}
return shouldQuery;
}</p><p>ES的DSL语句如下</p><p>{</p><p>&ldquo;size&rdquo; : 0,</p><p>&ldquo;query&rdquo; : {</p><p>&ldquo;bool&rdquo; : {</p><p>&ldquo;must&rdquo; : {&ldquo;bool&rdquo; : {&ldquo;should&rdquo; : {&ldquo;match&rdquo; : {&ldquo;widgetValue&rdquo; : {&ldquo;query&rdquo; : &ldquo;工作汇报&rdquo;,&ldquo;type&rdquo; : &ldquo;phrase&rdquo;}}}}},</p><p>&ldquo;filter&rdquo; : [</p><p>​ {&ldquo;bool&rdquo; : {&ldquo;should&rdquo; : {&ldquo;terms&rdquo; : {&ldquo;moudleId&rdquo; : [ 1, 2, 3, 4, 5 ]}}}},</p><p>​ {&ldquo;term&rdquo; : {&ldquo;deleteFlag&rdquo; : 0}},</p><p>​ {&ldquo;range&rdquo; : {&ldquo;modifyTime&rdquo; : {&ldquo;from&rdquo; : null,&ldquo;to&rdquo; : 1554180590383,&ldquo;include_lower&rdquo; : true,&ldquo;include_upper&rdquo; : false}} } ]}</p><p>},</p><p>&ldquo;aggregations&rdquo; : {</p><p>&ldquo;group_by_reportId&rdquo; : {</p><p>&ldquo;terms&rdquo; : {</p><p>​ &ldquo;field&rdquo; : &ldquo;reportId&rdquo;,&ldquo;size&rdquo; : 200,&ldquo;order&rdquo; : [ {&ldquo;sortA&rdquo; : &ldquo;desc&rdquo;}, {&ldquo;sortB&rdquo; : &ldquo;desc&rdquo;}, {"_term&rdquo; : &ldquo;asc&rdquo;} ]},</p><p>&ldquo;aggregations&rdquo; : {</p><p>​ &ldquo;sortA&rdquo; : {&ldquo;max&rdquo; : {&ldquo;field&rdquo; : &ldquo;reportDate&rdquo;}},</p><p>​ &ldquo;sortB&rdquo; : {&ldquo;max&rdquo; : {&ldquo;field&rdquo; : &ldquo;modifyTime&rdquo;}},</p><p>​ &ldquo;groupDataDetail&rdquo; : {&ldquo;top_hits&rdquo; : {&ldquo;size&rdquo; : 1, &ldquo;_source&rdquo; : {&ldquo;includes&rdquo; : [ &ldquo;accountId&rdquo;, &ldquo;atIds&rdquo;, &ldquo;companyId&rdquo;, &ldquo;coordinate&rdquo;, &ldquo;createTime&rdquo;, &ldquo;deleteFlag&rdquo;, &ldquo;modifyTime&rdquo;, &ldquo;moudleId&rdquo;, &ldquo;reportDate&rdquo;, &ldquo;widgetValue&rdquo; ],</p><p>​ &ldquo;excludes&rdquo; : [ ]} }}}}}}</p><p>经测试，该方案中ES环节所需时间稳定在0.8s左右，接口整体速度在1-6s。</p><p>优点：速度进一步提升且响应时间比较稳定</p><p>缺点：汇报相关的其他数据仍存储在MySQL中，整体接口瓶颈变为查询汇报其他数据时的速度过慢。</p><h2 id=5阶段d---elasticsearch--redis--mysql>5.阶段D - ElasticSearch + Redis + MySQL</h2><p>对整体接口相关数据进一步分析，根据数据修改频繁程度，可以将数据进行冷热分离，将修改频率较低的数据,如汇报主表与汇报子表，存储在ES中，并通过LogStash定时增量更新；将高频修改数据(如汇报的浏览数量)存储在Redis中，这样将会进一步提升搜索的响应速度。</p></div><footer class=post-footer><div class=post-tags><a href=https://1162492411.github.io/docs/tags/es rel=tag title=ES>#ES#</a>
<a href=https://1162492411.github.io/docs/tags/%e6%90%9c%e7%b4%a2 rel=tag title=搜索>#搜索#</a></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://1162492411.github.io/docs/post/%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/ rel=next title=参数校验><i class="fa fa-chevron-left"></i>参数校验</a></div><div class="post-nav-prev post-nav-item"><a href=https://1162492411.github.io/docs/post/mysql%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95/ rel=prev title=MySQL全文索引使用>MySQL全文索引使用 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap></li><li class=sidebar-nav-overview data-target=site-overview></li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=https://1162492411.github.io/docs/img/author.jpg alt=zyg><p class=site-author-name itemprop=name>zyg</p><p class="site-description motion-element" itemprop=description>Programmer & Architect</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=https://1162492411.github.io/docs/post/><span class=site-state-item-count>28</span>
<span class=site-state-item-name></span></a></div><div class="site-state-item site-state-categories"><a href=https://1162492411.github.io/docs/categories/><span class=site-state-item-count>27</span>
<span class=site-state-item-name></span></a></div><div class="site-state-item site-state-tags"><a href=https://1162492411.github.io/docs/tags/><span class=site-state-item-count>47</span>
<span class=site-state-item-name></span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/1162492411/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>GitHub</a></span></div><div class="links-of-blogroll motion-element inline"><script type=text/javascript src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&m=0&s=220&c=ff0000&cr1=ffffff&f=arial&l=33&bv=35" async></script></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#1背景介绍>1.背景介绍</a></li><li><a href=#11-表关系>1.1 表关系</a></li><li><a href=#12-数据增长速度>1.2 数据增长速度</a></li><li><a href=#13-搜索流程>1.3 搜索流程</a></li></ul><ul><li><a href=#3阶段b---mysql-全文索引>3.阶段B - MySQL <strong>全文索引</strong></a></li><li><a href=#4阶段c---elasticsearch--mysql>4.阶段C - ElasticSearch + MySQL</a></li><li><a href=#5阶段d---elasticsearch--redis--mysql>5.阶段D - ElasticSearch + Redis + MySQL</a></li></ul></nav></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span itemprop=copyrightYear>&copy;
2009 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span><span class=author itemprop=copyrightHolder></span></div><div class=powered-by>Powered by - <a class=theme-link href=http://gohugo.io target=_blank title=hugo>Hugo v0.68.3</a></div><div class=theme-info>Theme by - <a class=theme-link href=https://github.com/xtfly/hugo-theme-next target=_blank>NexT</a></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i><span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript>if(Object.prototype.toString.call(window.Promise)!=='[object Function]'){window.Promise=null;}</script><script type=text/javascript src="https://1162492411.github.io/docs/js/vendor/jquery/index.js?v=2.1.3"></script><script type=text/javascript src="https://1162492411.github.io/docs/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type=text/javascript src="https://1162492411.github.io/docs/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type=text/javascript src="https://1162492411.github.io/docs/js/vendor/velocity/velocity.min.js?v=1.2.1"></script><script type=text/javascript src="https://1162492411.github.io/docs/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="https://1162492411.github.io/docs/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script><script src="https://1162492411.github.io/docs/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script><script type=text/javascript src=https://1162492411.github.io/docs/js/utils.js></script><script type=text/javascript src=https://1162492411.github.io/docs/js/motion.js></script><script type=text/javascript src=https://1162492411.github.io/docs/js/affix.js></script><script type=text/javascript src=https://1162492411.github.io/docs/js/schemes/pisces.js></script><script type=text/javascript src=https://1162492411.github.io/docs/js/scrollspy.js></script><script type=text/javascript src=https://1162492411.github.io/docs/js/post-details.js></script><script type=text/javascript src=https://1162492411.github.io/docs/js/toc.js></script><script type=text/javascript src=https://1162492411.github.io/docs/js/bootstrap.js></script><script type=text/javascript src=https://1162492411.github.io/docs/js/search.js></script><script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>