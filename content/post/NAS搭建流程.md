---
title: "NAS搭建流程"
date: 2022-07-24T10:41:38+08:00
draft: true
toc: true
categories:
  - 环境搭建
tags:
  - 环境搭建
  - NAS
---

这里记录一下小白如何快速入手搭建一台家用NAS。由于图简单，盯上了“买软件送硬件”的群晖NAS，考虑到后期通过Docker开启更多功能，于是选购了920+。本人的需求大致为私有云、入手后大致进行了以下步骤以完成NAS的搭建与使用：

1. 开机:硬盘安装+系统安装
2. 登陆DMS管理端
3. 接入UPS

# 开机

* 开机
  * 任意位置插入一块3.5寸硬盘，连接电源线、网线后，按下机箱正面的开关按钮，等待几分钟后会听到"滴"的一声，同时机箱正面的灯处于常亮状态，这时已成功开机。
* 手机端安装控制软件
  * 说明书中带有手机端控制软件的二维码，可以扫描后下载；也可以在应用商店里搜索“群晖管家”下载安装
* 安装系统
  * 手机与机器连接同一个WIFI，进入手机端的控制软件"群晖管家"，点击“安装新设备”，逐步向下走，添加用户并设置密码(这里的账户是用于NAS内部,是整个NAS后台管理系统的账户),假设这里建立的用户名是user1
  * 等待一会,系统安装成功后会重启NAS,NAS启动完成后会发出"嘀"的一声
* 注册账户
  * 在手机端的“群晖管家”中注册Synology账户(这里的账户用于群晖官方网站,使用群晖的一些功能,例如QuickConnect、DDNS),假设这里建立的用户名是user2

# 登陆DMS管理端

接下来我们需要对系统进行一些初步设置,这里需要通过手机端的"群晖管家"进入DMS管理页面进行操作,或者在电脑端浏览器中进入DMS管理页面进行操作

## 方式一:手机登陆DMS



## 方式二: 电脑登陆DMS



## 修改一些系统配置项

​    为了避开一些网络的扫描软件和病毒程序攻击我们的设备，一般情况下要避开程序默认开启的各种端口。打开“控制面板”，可以修改以下端口

* 修改FTP/SFTP端口：“文件服务-FTP”，在这里修改FTP和SFTP的端口
* 修改外部访问端口：“外部访问-高级设置”，在这里修改DSM的HTTP端口号和HTTPS端口号
* 修改SSH端口：“终端机和SNMP”，在这里修改SSH端口
* 修改DSM端口：“登录门户”，在这里修改WEB端的DSM的HTTP端口号和HTTPS端口号

# 接入UPS



# 安装常用软件

​    群晖中的软件商店名为"套件中心"，这里的"套件"是指可以直接安装在群晖系统中的程序，格式为SPK。

​    我们进入NAS后台，打开“套件中心”，可以看到左边有三个菜单栏：“已安装”、“所有套件”、“Beta套件”，可以在这里搜索软件名进行软件的安装与卸载。

​    默认情况下，套件中心只有群晖官方与一些第三方公司开发的软件，事实上也存在一些民间的软件源，可以用来下载安装民间大神开发制作的软件。通过点击右上角的“设置-套件来源-新增”，可以添加民间软件源，添加后，套件中心左侧菜单栏将会新增一个“社群”，进入该页面后搜索安装民间软件源。

​    当然，除了以上几种在线安装的方式，群晖也支持离线安装。可以将SPK下载后在套件中心点击右上方的“手动安装”，将SPK上传后进行安装。

Docker、WebStation、Jellyfin(docker版)、ResilioSync、Synology Photos、WebDAV Server

# 补丁安装-安装2.5G网卡

​    920+这款NAS自带的两个网络接口均为1G网卡，对于有更高速率要求的用户，我们可以在USB接口中接入2.5G网卡来提高传输速率，这需要两方面的支持：硬件方面需要一个USB转2.5G网卡的转接器、一根网线、电脑端也需要有2.5G的接口与2.5G网卡；软件方面，NAS需要安装2.5G网卡驱动，同时需要让电脑和NAS处于单独的局域网内，电脑通过2.5G网线的ip连接到NAS。

​    硬件方面，我这边有一台MacBook，内置了4个霹雳接口，网卡方面为10G网卡，因此需要一个RJ45转TypeC的转接器，购买转接器的时候注意转接器中的网线口速率，如果该网口速率为1G，那么整体传输速率按硬件中的最短板来计算，整体速度将为1G，即125MB/s。USB转RJ45转接器这方面，我选购的是毕亚兹。

​    软件方面，NAS需要安装网线驱动，这里我们可以使用bb-qq适配的程序来安装，https://github.com/bb-qq/r8152/releases/tag/2.14.0-2，需要注意的是，如果NAS系统版本为DSM7，初次安装可能失败，按照安装包发布页面中的READ.ME提示,通过SSH登陆NAS执行一行命名即可再次安装，选择驱动的时候，需要在群晖的页面，https://kb.synology.com/en-global/DSM/tutorial/What_kind_of_CPU_does_my_NAS_have，查看自己的NAS所属的CPU是什么架构，这样在下载驱动时按照对应CPU架构的驱动包下载即可。

​    硬件和软件问题解决后，将USB转RJ45转换器插在NAS的USB接口中，接入网线，另一端连接电脑(这里注意重启NAs后连接，因为NAS不支持网线的热插拔)，在NAS的控制面板中，我们可以在“网络-网络界面”看到多出来了一个局域网，这就是我们新接入的网线，在这里分配新的局域网ip，电脑端在网线口对应的局域网内配置ip，后续我们通过该ip上传下载文件，即可享受到2.5G的速率，即310MB/s(当然这只是理论最高速度，实际上因为转换损耗等原因会降低一些)。

# 电脑与NAS互传文件

## 通过网线连接

在网线口额外插入一根网线，与电脑连接

## 通过FTP/SFTP连接

登陆"DMS"-"控制面板",打开ftp/sftp功能,设置端口;电脑通过ftp类软件登陆(mac:transmit...)

## 通过SMB连接

登陆"DMS"-"控制面板",打开ftp/sftp功能,设置端口;电脑通过smb://xxx连接到NAS的文件夹

## 通过WebDAV连接

登陆"DMS"-"套件中心",安装WebDAVSever,开启服务;电脑端通过http://ip地址:端口号连接到NAS的文件夹



# 连接到外网-zerotier

参考https://imnks.com/3175.html

# 视频文件导入NAS

## 整理视频文件

使用TMM软件为原始的视频文件补充视频信息(刮削)

### 刮削电影



### 刮削电视剧



### 增量刮削



## 传输视频文件

通过上一章节中的方式,将文件传输到NAS中

## 导入视频管理软件

进入软件管理视频文件:以Jellyfin Docker版为例讲解



## 观看视频文件

电脑端登陆DMS后台在浏览器中观看；手机端通过软件指定地址观看

## 搭建导航
    安装的软件和服务多了之后，由于每个服务都是通过端口号来区分的，因此需要记住很多的端口号；再加上我们也许有多个不同的访问地址
(eg.内网访问/外网访问/内网穿透访问)，这进一步增加了各服务地址的数量。为了方便我们登陆服务，因此有必要搭建一个导航页。这里我采用的是docker版本的`hemidall`,安装过程还是很简单的，上网搜索即可。
    这里假设我们有两种不同的方式来访问我们的`Jellyfin`服务、File服务，我们进入hemidall的页面后，进行如下的配置即可
* 建立两个Tag
    * 点击右下角的"标签"-"添加",在标签名中分别输入"外网"和"内网"，点击"保存"
* 添加应用列表
    * 点击右下角的"应用"-"添加"，标题填写"JF"，网址填写"http://内网ip:8096",标签选择刚才建立的"内网"，应用图标方面，可以点击"应用类型，从右侧列表中选择合适的图标，也可以点击下方的网址，输入图片地址，或者点击更下方的"上传图标"
    * 按照上述方式，我们添加外网的Jellyfin访问方式，不同的是网址和标签都选择为外网
* 将应用/Tag固定到仪表盘
    * 点击右下角第一个图标，再点击一次，会出现"固定到仪表盘"，我们将两个Tag添加到仪表盘即可
* 访问
    * 点击右下角第一个图标，我们看到有"内网"和"外网"两个图标，加入我们现在是内网，点击"内网"，就可以看到所有挂载在内网中的应用列表了






